language: node_js
matrix:
  fast_finish: true
node_js:
  - '8'
cache:
  yarn: true
  directories:
    - node_modules
script:
  - yarn lint
  - yarn test
  - yarn build:css:all
  - yarn build:doc:react
  - yarn screenshots --viewport desktop
  - yarn screenshots --no-empty-screenshot-dir --viewport 300x600
  - yarn argos --token $ARGOS_TOKEN --branch $TRAVIS_BRANCH --commit $TRAVIS_COMMIT
deploy:
  - provider: script
    repo: cozy/cozy-ui
    skip-cleanup: true
    script: yarn build:doc:kss && yarn deploy:doc -- --username cozycloud --email contact@cozycloud.cc --repo https://cozy-bot:$GH_TOKEN@github.com/cozy/cozy-ui.git && yarn semantic-release
    on:
      branch: master

env:
  global:
    # GH_TOKEN from mycozycloud (readable from password-store/cozy-ui/github-token-for-semantic-release-on-travis)
    - secure: rPQqo7cZCiEw4oUZvjn62oToLptwUdtvxKeuADo3l6cchn7/OnpXdL32JN6VuJrj/a2ebPKZmAmBNCYqQ5SmIaK7/3EKXPNNvgXmdwubjWE1VNls2Oj4XFZ+E5AyNV3KOq1MpOBa7ccNORmspthnTHWe7Z6b8dyv7I2KN2Igjac=
